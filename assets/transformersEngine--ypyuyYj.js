import{h as u}from"./index-BR4snZEi.js";const m={model:"Xenova/bert-base-multilingual-uncased-sentiment",fallbackModel:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"};let r=null,l=!1,s=!1,o=null;class f{constructor(){this.modelName=m.model}async init(){if(!(l||s)){s=!0,o=null;try{const{pipeline:n}=await u(async()=>{const{pipeline:e}=await import("./transformers-BNda8D0F.js");return{pipeline:e}},[]);console.log("[Sentiment] 載入模型中...",this.modelName),r=await n("sentiment-analysis",this.modelName,{device:"webgpu",cache_dir:"sentiment-models"}),l=!0,console.log("[Sentiment] 模型載入完成")}catch(n){console.warn("[Sentiment] 主模型載入失敗，嘗試備用模型",n);try{const{pipeline:e}=await u(async()=>{const{pipeline:a}=await import("./transformers-BNda8D0F.js");return{pipeline:a}},[]);this.modelName=m.fallbackModel,r=await e("sentiment-analysis",this.modelName),l=!0,console.log("[Sentiment] 備用模型載入完成")}catch(e){o=e,console.error("[Sentiment] 模型載入失敗",e)}}finally{s=!1}}}isReady(){return l&&!s}getInfo(){return{model:this.modelName,initialized:l,loading:s,error:(o==null?void 0:o.message)||null}}async analyze(n){if(!n||typeof n!="string")return{sentiment:"neutral",confidence:0,label:"中立"};if(l||await this.init(),!r)return{sentiment:"neutral",confidence:0,label:"中立"};try{const e=n.slice(0,512),a=await r(e);return this.convertResult(a[0])}catch(e){return console.error("[Sentiment] 分析失敗:",e),{sentiment:"neutral",confidence:0,label:"中立"}}}async analyzeBatch(n){if(!Array.isArray(n)||n.length===0)return[];if(l||await this.init(),!r)return n.map(()=>({sentiment:"neutral",confidence:0,label:"中立"}));try{const e=n.map(t=>(t||"").slice(0,512));return(await r(e)).map(t=>this.convertResult(t))}catch(e){return console.error("[Sentiment] 批次分析失敗:",e),n.map(()=>({sentiment:"neutral",confidence:0,label:"中立"}))}}convertResult(n){if(!n)return{sentiment:"neutral",confidence:0,label:"中立"};const{label:e,score:a}=n;let t,i;if(e.includes("star")||/^[1-5]$/.test(e)){const c=parseInt(e.replace(" star","").replace(" stars",""));c>=4?(t="bullish",i="看漲"):c<=2?(t="bearish",i="看跌"):(t="neutral",i="中立")}else e==="POSITIVE"||e==="positive"?(t="bullish",i="看漲"):e==="NEGATIVE"||e==="negative"?(t="bearish",i="看跌"):(t="neutral",i="中立");return{sentiment:t,confidence:a,label:i}}}export{f as TransformersEngine};
