let n={provider:null,apiKey:null,endpoint:null};class o{constructor(){this.isConfigured=!1}configure(e){n={...n,...e},this.isConfigured=!!(n.provider&&n.apiKey)}isReady(){return this.isConfigured}getInfo(){return{type:"api",provider:n.provider,configured:this.isConfigured}}async analyze(e){if(!this.isConfigured)return console.warn("[Sentiment API] API 尚未設定"),{sentiment:"neutral",confidence:0,label:"中立"};if(!e||typeof e!="string")return{sentiment:"neutral",confidence:0,label:"中立"};try{switch(n.provider){case"openai":return await this.analyzeWithOpenAI(e);case"anthropic":return await this.analyzeWithAnthropic(e);case"custom":return await this.analyzeWithCustom(e);default:return{sentiment:"neutral",confidence:0,label:"中立"}}}catch(i){return console.error("[Sentiment API] 分析失敗:",i),{sentiment:"neutral",confidence:0,label:"中立"}}}async analyzeWithOpenAI(e){const s=(await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'你是一個金融新聞情緒分析專家。請分析以下新聞標題對股價的影響，只回答 JSON 格式：{"sentiment": "bullish"|"bearish"|"neutral", "confidence": 0-1 的數字}'},{role:"user",content:e}],temperature:.1})})).json()).choices[0].message.content;try{const t=JSON.parse(s);return{sentiment:t.sentiment,confidence:t.confidence,label:t.sentiment==="bullish"?"看漲":t.sentiment==="bearish"?"看跌":"中立"}}catch{return{sentiment:"neutral",confidence:0,label:"中立"}}}async analyzeWithAnthropic(e){const s=(await(await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:100,messages:[{role:"user",content:`分析以下金融新聞標題對股價的影響，只回答 JSON：{"sentiment": "bullish"|"bearish"|"neutral", "confidence": 0-1}

${e}`}]})})).json()).content[0].text;try{const t=JSON.parse(s);return{sentiment:t.sentiment,confidence:t.confidence,label:t.sentiment==="bullish"?"看漲":t.sentiment==="bearish"?"看跌":"中立"}}catch{return{sentiment:"neutral",confidence:0,label:"中立"}}}async analyzeWithCustom(e){if(!n.endpoint)return{sentiment:"neutral",confidence:0,label:"中立"};const a=await(await fetch(n.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify({text:e})})).json();return{sentiment:a.sentiment||"neutral",confidence:a.confidence||0,label:a.sentiment==="bullish"?"看漲":a.sentiment==="bearish"?"看跌":"中立"}}async analyzeBatch(e){return Array.isArray(e)?Promise.all(e.map(i=>this.analyze(i))):[]}}export{o as ApiEngine};
